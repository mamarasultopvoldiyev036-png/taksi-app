<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haydovchi Paneli</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 10px; }
        .order-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-accept { background: #28a745; color: white; }
        .btn-finish { background: #dc3545; color: white; }
        .status-tag { font-size: 12px; padding: 4px 8px; border-radius: 4px; float: right; }
        .pending { background: #fff3cd; color: #856404; }
        .accepted { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <h3>üöñ Aktiv buyurtmalar</h3>
    <div id="orders-list">
        </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Bazadan zakazlarni olish (Sizning API manzilingiz bo'lishi kerak)
        async function loadOrders() {
            const response = await fetch('https://sizning-api.com/get_orders');
            const orders = await response.json();
            const list = document.getElementById('orders-list');
            list.innerHTML = '';

            orders.forEach(order => {
                const div = document.createElement('div');
                div.className = 'order-card';
                div.innerHTML = `
                    <span class="status-tag ${order.status}">${order.status}</span>
                    <p>üìç <b>Dan:</b> ${order.from_addr}</p>
                    <p>üèÅ <b>Gacha:</b> ${order.to_addr}</p>
                    <p>üí∞ <b>Narxi:</b> ${order.price} so'm</p>
                    ${order.status === 'pending' 
                        ? `<button class="btn btn-accept" onclick="updateStatus(${order.id}, 'accepted')">Qabul qilish</button>` 
                        : `<button class="btn btn-finish" onclick="updateStatus(${order.id}, 'finished')">Tugatish</button>`
                    }
                `;
                list.appendChild(div);
            });
        }

        async function updateStatus(orderId, newStatus) {
            const driverId = tg.initDataUnsafe.user.id;
            await fetch('https://sizning-api.com/update_order', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ order_id: orderId, status: newStatus, driver_id: driverId })
            });
            
            // Botga ma'lumot yuborish (Mijozni ogohlantirish uchun)
            tg.sendData(JSON.stringify({action: newStatus, order_id: orderId}));
            loadOrders(); // Ro'yxatni yangilash
        }

        setInterval(loadOrders, 5000); // Har 5 soniyada yangilab turadi
        loadOrders();
    </script>
</body>
</html>
